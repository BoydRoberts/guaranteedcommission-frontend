<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Printable ISC</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .font-cursive { font-family: 'Brush Script MT', cursive; }
  </style>
</head>
<body class="bg-white text-black p-8">

  <div class="max-w-3xl mx-auto border p-6 rounded shadow">
    <h1 class="text-xl font-bold text-center mb-6">Irrevocable Seller Communication (ISC)</h1>

    <div id="iscContent" class="text-sm space-y-4 leading-relaxed whitespace-pre-line">
      Loading ISC...
    </div>

    <p class="text-xs text-gray-500 mt-8 text-center" id="counters"></p>
  </div>

  <script>
    const data = JSON.parse(localStorage.getItem("formData") || "{}");
    const plan = localStorage.getItem("selectedPlan") || "Listed Property Basic";
    const signature = localStorage.getItem("signature") || "[Name]";
    const commissionType = data.commissionType || "%";
    const commission = data.commission || "";
    const suffix = commissionType === "%" ? " of the total purchase price" : "";
    const commissionDisplay = commissionType === "$" ? `$${commission}` : `${commission}%`;
    const apn = data.apn || "[Parcel # / Pin # / Tax ID # / Folio # / APN #]";
    const fullAddress = data.address || "[Full Address]";
    const shortAddress = fullAddress.split(',')[0] || "[Short Address]";
    const name = data.name || "[Name]";
    const date = new Date().toLocaleDateString();
    const isFSBO = plan.includes("FSBO");

    let text = `To the escrow holder/closing agent,\n\n`;

    if (isFSBO) {
      text += `I, ${name}, am the owner/seller of ${fullAddress}, #${apn}. ${shortAddress} is listed for sale by owner (Me). My phone number is ${data.agentPhone || "[Phone]"}. My email address is ${data.brokerage || "[Email]"}.\n\n`;
      text += `Let it be known: if a buyer’s agent/broker facilitates the sale of ${shortAddress}, you (the escrow holder/closing agent) are irrevocably instructed to credit/compensate the buyer’s broker a commission not to exceed ${commissionDisplay}${suffix}.`;
    } else {
      text += `I, ${name}, am the owner/seller of ${fullAddress}, #${apn}. ${shortAddress} is listed for sale by ${data.brokerage || "[Listing Brokerage]"}, ${data.agent || "[Listing Agent]"}, listing agent, ${data.agentPhone || "[Phone]"}.\n\n`;
      text += `Let it be known: if a buyer’s agent/broker facilitates the sale of ${shortAddress}, you (the escrow holder/closing agent) are irrevocably instructed to credit/compensate the buyer’s broker – first, by debiting the listing brokerage (if there is an agreement for broker-to-broker compensation) and second by debiting me, the seller – a commission not to exceed ${commissionDisplay}${suffix}.`;
    }

    text += `\n\n\n        ${signature} Electronic Signature                                  ${date}`;

    document.getElementById("iscContent").textContent = text;

    // Count views
    const viewKey = "iscViews";
    let views = parseInt(localStorage.getItem(viewKey) || "0") + 1;
    localStorage.setItem(viewKey, views);
    document.getElementById("counters").textContent = `This Irrevocable Seller Communication has been viewed ${views} time(s).`;
  </script>

</body>
</html>
