<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Review & Checkout</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-xl mx-auto mt-10 bg-white p-6 rounded shadow">
    <!-- Test badge -->
    <div class="mb-4">
      <span class="inline-block text-xs font-semibold px-2 py-1 bg-yellow-200 border border-yellow-400 rounded">
        TEST MODE — Stripe sandbox
      </span>
    </div>

    <h1 class="text-2xl font-bold text-center mb-6">Review & Checkout</h1>

    <div class="space-y-4 text-sm">
      <p><strong>Selected Plan:</strong> <span id="planName">Loading…</span></p>

      <div>
        <strong>Upgrades:</strong>
        <ul id="upgradeList" class="list-disc list-inside text-gray-700 mt-1"></ul>
      </div>

      <p class="mt-2 text-lg font-bold">Total: $<span id="totalAmount">0</span></p>
    </div>

    <button id="payNowBtn" class="w-full bg-green-600 text-white py-2 rounded mt-6">
      Pay Now with Stripe
    </button>

    <p class="text-xs text-gray-500 mt-4">
      You will be redirected to Stripe to complete payment (if required).
    </p>
  </div>

  <script>
    // Read normalized checkout payload built in upsell/verify steps
    const checkoutData = JSON.parse(localStorage.getItem("checkoutData") || "{}");

    // Robust plan fallback: checkoutData.plan -> selectedPlan -> 'Listed Property Basic'
    const planName = checkoutData.plan 
      ? checkoutData.plan 
      : (localStorage.getItem("selectedPlan") || "Listed Property Basic");

    // Render plan
    document.getElementById("planName").textContent = planName;

    // Render upgrades
    const upgrades = Array.isArray(checkoutData.upgrades) ? checkoutData.upgrades : [];
    const upgradeList = document.getElementById("upgradeList");
    upgradeList.innerHTML = upgrades.length 
      ? upgrades.map(u => `<li>${u}</li>`).join("")
      : "<li>None</li>";

    // Render total
    const total = Number(checkoutData.totalCost || 0);
    document.getElementById("totalAmount").textContent = total.toFixed(0);

    // (Payment click handled by checkout.js)
  </script>

  <script src="/checkout.js"></script>
</body>
</html>
