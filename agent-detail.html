<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Listing Detail Entry</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-2xl mx-auto mt-16 bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-6 text-center">Complete Listing Details as Agent</h1>

    <form id="agentForm" class="space-y-4">
      <div>
        <label class="block text-sm font-semibold mb-1">Property Address:</label>
        <p id="propertyAddress" class="bg-gray-100 border px-3 py-2 rounded text-sm"></p>
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1">Property Description:</label>
        <textarea id="description" rows="4" class="w-full border p-2 rounded" placeholder="Describe the property..."></textarea>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <input type="number" id="bedrooms" placeholder="Bedrooms" class="border p-2 rounded" />
        <input type="number" id="bathrooms" placeholder="Bathrooms" class="border p-2 rounded" />
        <input type="number" id="sqft" placeholder="Square Feet" class="border p-2 rounded" />
        <input type="number" id="price" placeholder="Listing Price ($)" class="border p-2 rounded" />
      </div>

      <div id="bannerSection" class="hidden">
        <label class="block text-sm font-semibold mb-1">Banner Text (30 characters max):</label>
        <input type="text" id="banner" maxlength="30" class="w-full border p-2 rounded" placeholder="e.g., Just Listed | Ocean View" />
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1">Upload Photos (up to 20):</label>
        <input type="file" id="photos" multiple accept="image/*" class="w-full border p-2 rounded" />
        <p class="text-xs text-gray-500 mt-1">Each image must be under 5MB.</p>
      </div>

      <button type="button" onclick="submitAgentListing()" class="w-full bg-blue-600 text-white py-2 rounded font-semibold">
        Save Listing Details
      </button>
    </form>
  </div>

  <script>
    const formData = JSON.parse(localStorage.getItem("formData") || "{}");
    document.getElementById("propertyAddress").textContent = formData.address || "[Property Address]";

    const hasBanner = localStorage.getItem("banner") === "true";
    if (hasBanner) {
      document.getElementById("bannerSection").classList.remove("hidden");
    }

    function submitAgentListing() {
      const listing = {
        description: document.getElementById("description").value.trim(),
        bedrooms: document.getElementById("bedrooms").value,
        bathrooms: document.getElementById("bathrooms").value,
        sqft: document.getElementById("sqft").value,
        price: document.getElementById("price").value,
        banner: hasBanner ? document.getElementById("banner").value.trim() : "",
        address: formData.address || "",
        photos: []
      };

      const files = document.getElementById("photos").files;
      if (files.length > 20) {
        alert("You can upload up to 20 photos only.");
        return;
      }

      for (let i = 0; i < files.length; i++) {
        if (files[i].size > 5 * 1024 * 1024) {
          alert(`Image "${files[i].name}" is too large. Limit is 5MB.`);
          return;
        }
        listing.photos.push(files[i].name); // Save file names for now
      }

      localStorage.setItem("agentListingDetails", JSON.stringify(listing));
      alert("Agent listing details saved.");
      window.location.href = "/agent-preview.html"; // placeholder
    }
  </script>

</body>
</html>
